{"componentChunkName":"component---src-pages-install-integration-aws-index-mdx","path":"/install/integration-aws/","result":{"pageContext":{"frontmatter":{"title":"CP4 Integration - AWS"},"relativePagePath":"/install/integration-aws/index.mdx","titleType":"page","MdxNode":{"id":"0ac6d463-1e32-58cd-9b8f-996d670e3a18","children":[],"parent":"a4b1e82d-bcbd-55b5-b850-627e4bddda6c","internal":{"content":"---\ntitle: CP4 Integration - AWS\n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\nInstall CP4I on Amazon Web Services\n</PageDescription>\n\n## **Overview**\n\nIBM Cloud Pak for Integration v2020.3.1 can be installed on AWS using Installer Provisioned Infrastructure (IPI) method or [AWS Quick start for CP4I](https://community.ibm.com/community/user/middleware/blogs/matt-roberts1/2020/11/12/aws-quickstart). While AWS Quick start provides a simplified one-click installation procedure, IPI provides full customization of OCP and CP4I installation which is preferred by advanced users.\n\nHere are a few basic differences between IPI and AWS quickstart methods.\n1. IPI provides full flexibility to administrators to configure the OpenShift cluster. While AWS quickstart is aimed at providing a simplified installation experience by asking users to input only essential configuration parameters with a form based UI.\n2. IPI lets administrators choose the OpenShift version, while AWS quickstart is only available with OCP v4.4.22 at the moment. For this recipe, we have chosen OCP v4.5.20 for IPI.\n3. IPI lets CP4I worker nodes to double up as OpenShift Container storage cluster nodes, while AWS Quickstart requires you to provision separate storage worker nodes. Although latter is a best practice it is not mandatory for POCs or demo environments.\n4. With IPI, only the OpenShift cluster is installed. An administrator can fully customize the CP4I installation - Common services and platform navigator. AWS Quick start installs CP4I with a standard configuration and offers installation of example instances of capabilities and runtimes.\n\n### **Ingredients**\n\n   1. AWS account\n   2. Red Hat pull secret\n   3. IBM software entitlement key to install Cloud Pak for Integration\n   4. DNS Domain\n   5. Linux server to initiate installation (bastion node)\n   6. CLI tools - oc-cli\n\n## **Step-by-step**\n\n### **1.  Setting up pre-requisites on AWS **\n   Before you begin, you must have an account with [Amazon Web Services](https://aws.amazon.com). Sign up for an account if you do not have one already. If you are using an enterprise account, ask your AWS administrator to grant you appropriate access. \n\n   **1.1  [Configuring a public hosted zone](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingHostedZone.html):**\n      \n   In order to successfully install your OpenShift cluster and access it post installation, you need DNS resolution and name lookup for external connections to the cluster. To do this on Amazon Web Services (AWS) account, you must have a dedicated public hosted zone in your Route53 service.  This is a critical step as the OpenShift installer tries to connect to OpenShift cluster using the DNS names that are created dynamically. Installation will fail if the hostnames are not resolved automatically. Refer to [instructions](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingHostedZone.html) to create new public hosted zone on Route53 console. For more information on this topic refer to [OpenShift documentation](https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-route53_installing-aws-account).\n   \n   ![Create_Hosted_domain](images/hosted_domain_create.png)\n\n   **1.2  [Configure an IAM user](https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-iam-user_installing-aws-account):**\n\n   In order to provision an OpenShift cluster, you need to create a user with programmatic access and administrator privileges. Refer to [instructions](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html) to create it. Make a note of the **Access key ID** and **Secret access key** created. If you do not have access to perform this task, you may want to reach out to your enterprise AWS admin.\n   \n   **1.3  [Set AWS Account limits](https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-limits_installing-aws-account):**\n\n   Installing an OpenShift cluster involves provisioning several AWS components. Ensure adequate [account limits ](https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-limits_installing-aws-account) are set in order to provision a cluster of the required size.\n   \n   \n### **2.  Download Red Hat pull secret, OCP installer and cli tools**\n   \n   **2.1  Red Hat pull secret**\n   \n   To perform the OpenShift installation you would require a Red Hat pull secret. You can download it from the Red Hat website. You will need to register if you do not have a login already.\n   \n   https://cloud.redhat.com/openshift/install/aws/installer-provisioned\n   \n   ______________________________________________________________________________________________________________\n   ![Pull secret](images/oc_pull_secret.png)\n   ______________________________________________________________________________________________________________\n   \n   **2.2  Download installation files**\n\n   CP4I v2020.3.1 requires OCP v4.4.13+ or v4.5.x. For this installation, we chose OpenShift v4.5.20.  For prerequisties, refer to the Knowledge Center’s [System Requirements](https://www.ibm.com/support/knowledgecenter/en/SSGT7J_20.3/install/sysreqs.html) page.\n   \n   Download the required installer and client version from following site.\n\n   https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/\n   \n   Here are the commands we've executed to download and prep for the installation on my MacOS bastion node. You can choose to install from a workstation/VM of your choice – ubuntu, mac or windows using linux shell. \n   \n    ```\n    mkdir ocp-4.5.20\n    cd ocp-4.5.20\n    wget https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.5.20/openshift-client-linux-4.5.20.tar.gz\n    wget https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.5.20/openshift-install-linux-4.5.20.tar.gz\n    tar -xvf openshift-install-linux-4.5.20.tar.gz\n    tar -xvf openshift-client-linux-4.5.20.tar.gz\n    sudo mv kubectl /usr/local/bin/kubectl\n    sudo mv oc /usr/local/bin/oc\n    ```\n\n   Verify if OpenShift installer, oc and kubectl tools are in place. \n\n   ```\n   oc version --client\n   kubectl version --client\n   ```\n   ______________________________________________________________________________________________________________\n   ![oc cli installer](images/oc_cli_installer-1.png)\n   ______________________________________________________________________________________________________________\n\n### **3.  Installing OpenShift with installer**\n\n   Generate ssh private keys and adding to the agent. This is required to debug installation and disaster recovery of the cluster. Refer to section 1.4.3 in the link for more information.\n   \n   **3.1  Create an ssh key:**\n   ```\n   ssh-keygen -t rsa -b 4096 -N '' \\\n       -f ~/.ssh/ocp_id_rsa\n   ```\n   \n   **3.2  Start ssh agent and add ssh private key to it**\n   ```\n   eval \"$(ssh-agent -s)\"\n   ssh-add ~/.ssh/ocp_id_rsa\n   ```\n   \n   **3.3  OpenShift Configuration**\n\n   In this recipe we are going to customize the installation to add the following configuration. \n   \n   – 3 Master Nodes with 8 CPU and 32 GB RAM\n\n   – 3 Worker Nodes with 32 CPU and 128 GB RAM\n   \n   This should be adequate to install all CP4I capabilites, runtimes and add-ons for demo purposes. For this recipe, the worker nodes also double up as OpenShift Container Storage worker nodes, hence we've chosen large worker nodes. However, it is recommended to setup 3 additional worker nodes for OCS. You may choose to adjust the # of worker nodes to add or reduce capacity. Refer to the [cloudpak8s.io](https://cloudpak8s.io/integration/cp4i-requirements/) for deployment best practices.\n   \n   **3.4  Create the install-config.yaml file**\n   \n   On the bastion node, run the following command. You will be prompted to enter the **AWS Access key ID** and **Secret access key**.\n   \n   ```\n   ./openshift-install create install-config --dir=<installation_directory> --log-level=debug\n   ```\n   Upon completion, *install-config.yaml* file is created inside the installation direction specified.\n   ______________________________________________________________________________________________________________\n   ![Create Install Config](images/CreateInstallConfig-1.png)\n   ______________________________________________________________________________________________________________\n\n   **3.5  Customize the install-config.yaml file**\n\n   Edit the install-config.yaml file to include the VM `type`, `Cluster name`, `replicas`, `region`, `zones` and `baseDomain`.To find out the type of VM sizes available in the region, refer to the following AWS documentation.\n   \n   https://aws.amazon.com/ec2/instance-types/\n   ______________________________________________________________________________________________________________\n   ![AWS Instances](images/AWS_EC2_VMs.png)\n   ______________________________________________________________________________________________________________\n\n   Make a note of the VM sizes you wish to use for your Master and Worker nodes and **exit** the page. For this recipe, we've have chosen *m5.8xlarge* for the Worker nodes and *m5.2xlarge* for the Master nodes.\n   \n   **NOTE:** Be sure to add zones in the yaml only if the AWS zones support it, else the installation is likely to fail. To see all regions and the zone availability check the AWS [regions](https://aws.amazon.com/about-aws/global-infrastructure/regions_az/) website.\n   \n   https://aws.amazon.com/about-aws/global-infrastructure/regions_az/\n   \n   Here is a sample install-config.yaml. For more on customization on of install-config.yaml refer to the following [Red Hat documentation](https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-customizations.html#installation-aws-config-yaml_installing-aws-customizations).\n   \n   ```\n   apiVersion: v1\n   baseDomain: yourdomain.com\n   compute:\n   - architecture: amd64\n     hyperthreading: Enabled\n     name: worker\n     platform:\n       aws:\n         rootVolume:\n           iops: 2000\n           size: 1024\n           type: io1\n         type: m5.8xlarge\n         zones:\n         - us-east-2a\n         - us-east-2b\n         - us-east-2c\n     replicas: 3\n   controlPlane:\n     architecture: amd64\n     hyperthreading: Enabled\n     name: master\n     platform:\n       aws:\n         zones:\n         - us-east-2a\n         - us-east-2b\n         - us-east-2c\n         rootVolume:\n           iops: 4000\n           size: 500\n           type: io1\n         type: m5.2xlarge\n     replicas: 3\n   metadata:\n     creationTimestamp: null\n     name: gsi-cp4i-7\n   networking:\n     clusterNetwork:\n     - cidr: 10.128.0.0/14\n       hostPrefix: 23\n     machineNetwork:\n     - cidr: 10.0.0.0/16\n     networkType: OpenShiftSDN\n     serviceNetwork:\n     - 172.30.0.0/16\n   platform:\n     aws:\n       region: us-east-2\n   publish: External\n   pullSecret: <Red Hat pull secret goes here>\n   sshKey: |\n     <sshkey goes here>   \n   ```\n   \n   **3.6  Run the installation program**\n   \n   Use the install-config.yaml file to create the OpenShift cluster.\n   \n   ```\n   ./openshift-install create cluster ---dir=<installation_directory> --log-level=debug\n   ```\n   \n   You may be prompted to enter the **AWS Access key ID** and **Secret access key**.\n   ______________________________________________________________________________________________________________\n   ![OC create cluster](images/oc_install_start.png)\n   ______________________________________________________________________________________________________________\n\n   If you are re-running an install, the **AWS Access key ID** and **Secret access key** are picked up from ~/.aws/credentials\n   \n   When the installation completes, note down the webconsole URL and kubeadmin credentials. This may take upto an hour to complete.\n\n   ______________________________________________________________________________________________________________\n   ![OC install complete](images/ocp_cluster_created.png)\n   ______________________________________________________________________________________________________________\n   \n   You can now launch the web-console in browser and use the kubeadmin credentials to login.\n   ______________________________________________________________________________________________________________\n   ![OpenShift_console](images/oc_dashboard_2.png)\n   ______________________________________________________________________________________________________________\n\n   You can also see the master and worker nodes running on AWS EC2 console.\n   ______________________________________________________________________________________________________________\n   ![AWS EC2 console](images/masters_workers_running.png)\n   ______________________________________________________________________________________________________________\n\n### **4.  Install OpenShift Container Storage Operator for File Storage**   \n    \n   **OpenShift Container Storage** must be installed for provisioning a CP4I compatible file storage on AWS which abstracts all platform specifics. It is important to note OCS is a **licensed** offering from Red Hat.\n   \n   Follow the OCS installation procedure described in [Red Hat documentation](https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage/4.5/html/deploying_openshift_container_storage_using_amazon_web_services/index)\n   \n   While installing the OCS operator, be sure to choose “stable 4.5” update stream. \n   \n   The instructions walk you through installation of the OCS operator and creating an instance of a storage cluster.\n   ______________________________________________________________________\n   ![Install OCS_operator_4.5](images/ocs_install_operator.png)\n   ______________________________________________________________________\n   ![Create OCS cluster](images/ocs_cluster_create.png)\n   ______________________________________________________________________\n\n   After you have created an OCS instance. You should see the following storage classes.\n\n   ![storage-classes](images/all_sc.png)\n   \n   You can now install CP4I Capabilites and Runtimes using the following storage classes.\n   \n   **Block storage**  – `gp2` (AWS default storage class) or `ocs-storagecluster-ceph-rbd` (OCS block storage)\n   \n   **File storage**   –  `ocs-storagecluster-cephfs` (OCS block storage)\n\n### **5.  Install Cloud Pak for Integration**\n   Refer to the CP4I installation runbook and Knowledge center for instructions of the common services, the platform navigator and other capabilities and runtimes.\n   \n   https://ibm-gsi-ecosystem.github.io/ibm-enterprise-runbooks/install/integration-operator\n   \n   https://www.ibm.com/support/knowledgecenter/en/SSGT7J_20.3/install/install.html\n   \n   **5.1  Known issues with Common services installation**\n   \n   While installing the common services, several pods may be stuck in \"CreateContainerConfigError\" or \"Init\" state.\n   ![Common_services_error](images/Common_service_error.png)\n \n   To resolve this issue, restart the iam-onboarding job in ibm-common-services namespace. Follow instructions listed in the knowledge center.\n   https://www.ibm.com/support/knowledgecenter/SSHKN6/iam/3.x.x/troubleshoot/iam_pods.html\n   \n   **PVC bound:**\n   ![pvc_bound](images/pvc_bound.png)\n   \n   **Capabilities installed:**\n   ![Installed Capabilities](images/Capabilities_installed.png)\n   \n   **Installed Runtimes:**\n   ![Installed Runtimes](images/runtimes_installed.png)\n\n\n### **6.  Conclusion**\n\n   Here is a quick summary of what we’ve covered in this recipe.\n   1. Prepped an AWS account for OpenShift installation.\n   2. Setup a bastion node with required tools to initiate OpenShift installation.\n   3. Created a install-config.yaml to perform a customized install of an OCP cluster.\n   4. Installed OCP cluster v4.5.20.\n   5. Installed OpenShift Container Storage for creating cephfs storage class to be used by CP4I.\n   6. Installed Cloud Pak for Integration v2020.3.1.\n   7. Installed Common services, Operations Dashboard, API Connect, App Connect, MQ, Asset Repository and Event Streams.\n\n\n\n### **7.  References**\n\n**IBM**\n   - https://community.ibm.com/community/user/middleware/blogs/matt-roberts1/2020/11/12/aws-quickstart\n   - https://www.ibm.com/support/knowledgecenter/en/SSGT7J_20.3/install/sysreqs.html\n   - https://ibm-gsi-ecosystem.github.io/ibm-enterprise-runbooks/install/integration-operator\n   - https://www.ibm.com/support/knowledgecenter/en/SSGT7J_20.3/install/install.html\n    ______________________________________________________________________________________________________________\n\n\n**Amazon Web Services**\n   - https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingHostedZone.html\n   - https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html\n    ______________________________________________________________________________________________________________\n \n**Red Hat OpenShift**\n   - https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-route53_installing-aws-account\n   - https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-iam-user_installing-aws-account\n   - https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-limits_installing-aws-account\n   - https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage/4.5/html/deploying_openshift_container_storage_using_amazon_web_services/index\n","type":"Mdx","contentDigest":"36d105a671bbd3c4dc5fc5b5f2bb3458","counter":926,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"CP4 Integration - AWS"},"exports":{},"rawBody":"---\ntitle: CP4 Integration - AWS\n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\nInstall CP4I on Amazon Web Services\n</PageDescription>\n\n## **Overview**\n\nIBM Cloud Pak for Integration v2020.3.1 can be installed on AWS using Installer Provisioned Infrastructure (IPI) method or [AWS Quick start for CP4I](https://community.ibm.com/community/user/middleware/blogs/matt-roberts1/2020/11/12/aws-quickstart). While AWS Quick start provides a simplified one-click installation procedure, IPI provides full customization of OCP and CP4I installation which is preferred by advanced users.\n\nHere are a few basic differences between IPI and AWS quickstart methods.\n1. IPI provides full flexibility to administrators to configure the OpenShift cluster. While AWS quickstart is aimed at providing a simplified installation experience by asking users to input only essential configuration parameters with a form based UI.\n2. IPI lets administrators choose the OpenShift version, while AWS quickstart is only available with OCP v4.4.22 at the moment. For this recipe, we have chosen OCP v4.5.20 for IPI.\n3. IPI lets CP4I worker nodes to double up as OpenShift Container storage cluster nodes, while AWS Quickstart requires you to provision separate storage worker nodes. Although latter is a best practice it is not mandatory for POCs or demo environments.\n4. With IPI, only the OpenShift cluster is installed. An administrator can fully customize the CP4I installation - Common services and platform navigator. AWS Quick start installs CP4I with a standard configuration and offers installation of example instances of capabilities and runtimes.\n\n### **Ingredients**\n\n   1. AWS account\n   2. Red Hat pull secret\n   3. IBM software entitlement key to install Cloud Pak for Integration\n   4. DNS Domain\n   5. Linux server to initiate installation (bastion node)\n   6. CLI tools - oc-cli\n\n## **Step-by-step**\n\n### **1.  Setting up pre-requisites on AWS **\n   Before you begin, you must have an account with [Amazon Web Services](https://aws.amazon.com). Sign up for an account if you do not have one already. If you are using an enterprise account, ask your AWS administrator to grant you appropriate access. \n\n   **1.1  [Configuring a public hosted zone](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingHostedZone.html):**\n      \n   In order to successfully install your OpenShift cluster and access it post installation, you need DNS resolution and name lookup for external connections to the cluster. To do this on Amazon Web Services (AWS) account, you must have a dedicated public hosted zone in your Route53 service.  This is a critical step as the OpenShift installer tries to connect to OpenShift cluster using the DNS names that are created dynamically. Installation will fail if the hostnames are not resolved automatically. Refer to [instructions](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingHostedZone.html) to create new public hosted zone on Route53 console. For more information on this topic refer to [OpenShift documentation](https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-route53_installing-aws-account).\n   \n   ![Create_Hosted_domain](images/hosted_domain_create.png)\n\n   **1.2  [Configure an IAM user](https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-iam-user_installing-aws-account):**\n\n   In order to provision an OpenShift cluster, you need to create a user with programmatic access and administrator privileges. Refer to [instructions](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html) to create it. Make a note of the **Access key ID** and **Secret access key** created. If you do not have access to perform this task, you may want to reach out to your enterprise AWS admin.\n   \n   **1.3  [Set AWS Account limits](https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-limits_installing-aws-account):**\n\n   Installing an OpenShift cluster involves provisioning several AWS components. Ensure adequate [account limits ](https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-limits_installing-aws-account) are set in order to provision a cluster of the required size.\n   \n   \n### **2.  Download Red Hat pull secret, OCP installer and cli tools**\n   \n   **2.1  Red Hat pull secret**\n   \n   To perform the OpenShift installation you would require a Red Hat pull secret. You can download it from the Red Hat website. You will need to register if you do not have a login already.\n   \n   https://cloud.redhat.com/openshift/install/aws/installer-provisioned\n   \n   ______________________________________________________________________________________________________________\n   ![Pull secret](images/oc_pull_secret.png)\n   ______________________________________________________________________________________________________________\n   \n   **2.2  Download installation files**\n\n   CP4I v2020.3.1 requires OCP v4.4.13+ or v4.5.x. For this installation, we chose OpenShift v4.5.20.  For prerequisties, refer to the Knowledge Center’s [System Requirements](https://www.ibm.com/support/knowledgecenter/en/SSGT7J_20.3/install/sysreqs.html) page.\n   \n   Download the required installer and client version from following site.\n\n   https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/\n   \n   Here are the commands we've executed to download and prep for the installation on my MacOS bastion node. You can choose to install from a workstation/VM of your choice – ubuntu, mac or windows using linux shell. \n   \n    ```\n    mkdir ocp-4.5.20\n    cd ocp-4.5.20\n    wget https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.5.20/openshift-client-linux-4.5.20.tar.gz\n    wget https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.5.20/openshift-install-linux-4.5.20.tar.gz\n    tar -xvf openshift-install-linux-4.5.20.tar.gz\n    tar -xvf openshift-client-linux-4.5.20.tar.gz\n    sudo mv kubectl /usr/local/bin/kubectl\n    sudo mv oc /usr/local/bin/oc\n    ```\n\n   Verify if OpenShift installer, oc and kubectl tools are in place. \n\n   ```\n   oc version --client\n   kubectl version --client\n   ```\n   ______________________________________________________________________________________________________________\n   ![oc cli installer](images/oc_cli_installer-1.png)\n   ______________________________________________________________________________________________________________\n\n### **3.  Installing OpenShift with installer**\n\n   Generate ssh private keys and adding to the agent. This is required to debug installation and disaster recovery of the cluster. Refer to section 1.4.3 in the link for more information.\n   \n   **3.1  Create an ssh key:**\n   ```\n   ssh-keygen -t rsa -b 4096 -N '' \\\n       -f ~/.ssh/ocp_id_rsa\n   ```\n   \n   **3.2  Start ssh agent and add ssh private key to it**\n   ```\n   eval \"$(ssh-agent -s)\"\n   ssh-add ~/.ssh/ocp_id_rsa\n   ```\n   \n   **3.3  OpenShift Configuration**\n\n   In this recipe we are going to customize the installation to add the following configuration. \n   \n   – 3 Master Nodes with 8 CPU and 32 GB RAM\n\n   – 3 Worker Nodes with 32 CPU and 128 GB RAM\n   \n   This should be adequate to install all CP4I capabilites, runtimes and add-ons for demo purposes. For this recipe, the worker nodes also double up as OpenShift Container Storage worker nodes, hence we've chosen large worker nodes. However, it is recommended to setup 3 additional worker nodes for OCS. You may choose to adjust the # of worker nodes to add or reduce capacity. Refer to the [cloudpak8s.io](https://cloudpak8s.io/integration/cp4i-requirements/) for deployment best practices.\n   \n   **3.4  Create the install-config.yaml file**\n   \n   On the bastion node, run the following command. You will be prompted to enter the **AWS Access key ID** and **Secret access key**.\n   \n   ```\n   ./openshift-install create install-config --dir=<installation_directory> --log-level=debug\n   ```\n   Upon completion, *install-config.yaml* file is created inside the installation direction specified.\n   ______________________________________________________________________________________________________________\n   ![Create Install Config](images/CreateInstallConfig-1.png)\n   ______________________________________________________________________________________________________________\n\n   **3.5  Customize the install-config.yaml file**\n\n   Edit the install-config.yaml file to include the VM `type`, `Cluster name`, `replicas`, `region`, `zones` and `baseDomain`.To find out the type of VM sizes available in the region, refer to the following AWS documentation.\n   \n   https://aws.amazon.com/ec2/instance-types/\n   ______________________________________________________________________________________________________________\n   ![AWS Instances](images/AWS_EC2_VMs.png)\n   ______________________________________________________________________________________________________________\n\n   Make a note of the VM sizes you wish to use for your Master and Worker nodes and **exit** the page. For this recipe, we've have chosen *m5.8xlarge* for the Worker nodes and *m5.2xlarge* for the Master nodes.\n   \n   **NOTE:** Be sure to add zones in the yaml only if the AWS zones support it, else the installation is likely to fail. To see all regions and the zone availability check the AWS [regions](https://aws.amazon.com/about-aws/global-infrastructure/regions_az/) website.\n   \n   https://aws.amazon.com/about-aws/global-infrastructure/regions_az/\n   \n   Here is a sample install-config.yaml. For more on customization on of install-config.yaml refer to the following [Red Hat documentation](https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-customizations.html#installation-aws-config-yaml_installing-aws-customizations).\n   \n   ```\n   apiVersion: v1\n   baseDomain: yourdomain.com\n   compute:\n   - architecture: amd64\n     hyperthreading: Enabled\n     name: worker\n     platform:\n       aws:\n         rootVolume:\n           iops: 2000\n           size: 1024\n           type: io1\n         type: m5.8xlarge\n         zones:\n         - us-east-2a\n         - us-east-2b\n         - us-east-2c\n     replicas: 3\n   controlPlane:\n     architecture: amd64\n     hyperthreading: Enabled\n     name: master\n     platform:\n       aws:\n         zones:\n         - us-east-2a\n         - us-east-2b\n         - us-east-2c\n         rootVolume:\n           iops: 4000\n           size: 500\n           type: io1\n         type: m5.2xlarge\n     replicas: 3\n   metadata:\n     creationTimestamp: null\n     name: gsi-cp4i-7\n   networking:\n     clusterNetwork:\n     - cidr: 10.128.0.0/14\n       hostPrefix: 23\n     machineNetwork:\n     - cidr: 10.0.0.0/16\n     networkType: OpenShiftSDN\n     serviceNetwork:\n     - 172.30.0.0/16\n   platform:\n     aws:\n       region: us-east-2\n   publish: External\n   pullSecret: <Red Hat pull secret goes here>\n   sshKey: |\n     <sshkey goes here>   \n   ```\n   \n   **3.6  Run the installation program**\n   \n   Use the install-config.yaml file to create the OpenShift cluster.\n   \n   ```\n   ./openshift-install create cluster ---dir=<installation_directory> --log-level=debug\n   ```\n   \n   You may be prompted to enter the **AWS Access key ID** and **Secret access key**.\n   ______________________________________________________________________________________________________________\n   ![OC create cluster](images/oc_install_start.png)\n   ______________________________________________________________________________________________________________\n\n   If you are re-running an install, the **AWS Access key ID** and **Secret access key** are picked up from ~/.aws/credentials\n   \n   When the installation completes, note down the webconsole URL and kubeadmin credentials. This may take upto an hour to complete.\n\n   ______________________________________________________________________________________________________________\n   ![OC install complete](images/ocp_cluster_created.png)\n   ______________________________________________________________________________________________________________\n   \n   You can now launch the web-console in browser and use the kubeadmin credentials to login.\n   ______________________________________________________________________________________________________________\n   ![OpenShift_console](images/oc_dashboard_2.png)\n   ______________________________________________________________________________________________________________\n\n   You can also see the master and worker nodes running on AWS EC2 console.\n   ______________________________________________________________________________________________________________\n   ![AWS EC2 console](images/masters_workers_running.png)\n   ______________________________________________________________________________________________________________\n\n### **4.  Install OpenShift Container Storage Operator for File Storage**   \n    \n   **OpenShift Container Storage** must be installed for provisioning a CP4I compatible file storage on AWS which abstracts all platform specifics. It is important to note OCS is a **licensed** offering from Red Hat.\n   \n   Follow the OCS installation procedure described in [Red Hat documentation](https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage/4.5/html/deploying_openshift_container_storage_using_amazon_web_services/index)\n   \n   While installing the OCS operator, be sure to choose “stable 4.5” update stream. \n   \n   The instructions walk you through installation of the OCS operator and creating an instance of a storage cluster.\n   ______________________________________________________________________\n   ![Install OCS_operator_4.5](images/ocs_install_operator.png)\n   ______________________________________________________________________\n   ![Create OCS cluster](images/ocs_cluster_create.png)\n   ______________________________________________________________________\n\n   After you have created an OCS instance. You should see the following storage classes.\n\n   ![storage-classes](images/all_sc.png)\n   \n   You can now install CP4I Capabilites and Runtimes using the following storage classes.\n   \n   **Block storage**  – `gp2` (AWS default storage class) or `ocs-storagecluster-ceph-rbd` (OCS block storage)\n   \n   **File storage**   –  `ocs-storagecluster-cephfs` (OCS block storage)\n\n### **5.  Install Cloud Pak for Integration**\n   Refer to the CP4I installation runbook and Knowledge center for instructions of the common services, the platform navigator and other capabilities and runtimes.\n   \n   https://ibm-gsi-ecosystem.github.io/ibm-enterprise-runbooks/install/integration-operator\n   \n   https://www.ibm.com/support/knowledgecenter/en/SSGT7J_20.3/install/install.html\n   \n   **5.1  Known issues with Common services installation**\n   \n   While installing the common services, several pods may be stuck in \"CreateContainerConfigError\" or \"Init\" state.\n   ![Common_services_error](images/Common_service_error.png)\n \n   To resolve this issue, restart the iam-onboarding job in ibm-common-services namespace. Follow instructions listed in the knowledge center.\n   https://www.ibm.com/support/knowledgecenter/SSHKN6/iam/3.x.x/troubleshoot/iam_pods.html\n   \n   **PVC bound:**\n   ![pvc_bound](images/pvc_bound.png)\n   \n   **Capabilities installed:**\n   ![Installed Capabilities](images/Capabilities_installed.png)\n   \n   **Installed Runtimes:**\n   ![Installed Runtimes](images/runtimes_installed.png)\n\n\n### **6.  Conclusion**\n\n   Here is a quick summary of what we’ve covered in this recipe.\n   1. Prepped an AWS account for OpenShift installation.\n   2. Setup a bastion node with required tools to initiate OpenShift installation.\n   3. Created a install-config.yaml to perform a customized install of an OCP cluster.\n   4. Installed OCP cluster v4.5.20.\n   5. Installed OpenShift Container Storage for creating cephfs storage class to be used by CP4I.\n   6. Installed Cloud Pak for Integration v2020.3.1.\n   7. Installed Common services, Operations Dashboard, API Connect, App Connect, MQ, Asset Repository and Event Streams.\n\n\n\n### **7.  References**\n\n**IBM**\n   - https://community.ibm.com/community/user/middleware/blogs/matt-roberts1/2020/11/12/aws-quickstart\n   - https://www.ibm.com/support/knowledgecenter/en/SSGT7J_20.3/install/sysreqs.html\n   - https://ibm-gsi-ecosystem.github.io/ibm-enterprise-runbooks/install/integration-operator\n   - https://www.ibm.com/support/knowledgecenter/en/SSGT7J_20.3/install/install.html\n    ______________________________________________________________________________________________________________\n\n\n**Amazon Web Services**\n   - https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingHostedZone.html\n   - https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html\n    ______________________________________________________________________________________________________________\n \n**Red Hat OpenShift**\n   - https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-route53_installing-aws-account\n   - https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-iam-user_installing-aws-account\n   - https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-limits_installing-aws-account\n   - https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage/4.5/html/deploying_openshift_container_storage_using_amazon_web_services/index\n","fileAbsolutePath":"/home/runner/work/ibm-enterprise-runbooks/ibm-enterprise-runbooks/src/pages/install/integration-aws/index.mdx"}}},"staticQueryHashes":["1364590287","2102389209","2102389209","243517648","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","63531786","63531786","768070550","817386451"]}